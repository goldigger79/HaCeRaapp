<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Semakan Jurang Halal (eHalalGAP)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body class="bg-gray-50 font-[Inter]">
  <div id="app-container">
    <div class="h-screen flex items-center justify-center">
      <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-teal-500"></div>
      <p class="ml-4 text-teal-600">Memuatkan Aplikasi...</p>
    </div>
  </div>

  <!-- Modal Laporan -->
  <div id="report-modal" class="modal hidden fixed inset-0 bg-black/60 justify-center items-center z-50">
    <div class="modal-content bg-white rounded-2xl shadow-xl w-[95%] max-w-[1200px] max-h-[95vh] overflow-y-auto">
      <div class="sticky top-0 bg-white border-b p-4 flex justify-between items-center rounded-t-xl z-10">
        <h2 class="text-2xl font-bold">Preview Laporan Penuh</h2>
        <button onclick="window.toggleModal(false)" class="text-gray-500 hover:text-gray-800">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div id="modal-report-body" class="p-6"></div>
      <div class="sticky bottom-0 bg-gray-50 border-t p-4 flex justify-center rounded-b-xl space-x-4">
        <button onclick="window.toggleModal(false)" class="btn-secondary px-6 py-3 rounded-xl font-semibold bg-gray-200 hover:bg-gray-300 text-gray-800 flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
          Tutup
        </button>
        <button onclick="window.printReport()" class="btn-primary px-6 py-3 rounded-xl bg-teal-600 hover:bg-teal-700 text-white font-semibold flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 9l6 6 6-6"/></svg>
          Cetak Laporan
        </button>
        <button id="download-pdf-btn" onclick="window.downloadReportPDF()" class="btn-primary px-6 py-3 rounded-xl bg-teal-600 hover:bg-teal-700 text-white font-semibold flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
          Muat Turun PDF
        </button>
      </div>
    </div>
  </div>

  <script>
  window.toggleModal = (show) => {
    const modal = document.getElementById('report-modal');
    if (!modal) return;
    modal.style.display = show ? 'flex' : 'none';
    if (show) {
      const modalBody = document.getElementById('modal-report-body');
      if (modalBody) {
        modalBody.innerHTML = '<h2 class="text-center text-xl font-bold mb-4">Contoh Kandungan Laporan</h2><div id="pdf-content-container" class="p-4 bg-white">Isi laporan akan dijana di sini...</div>';
      }
    }
  };

  window.printReport = async () => {
    const modalBody = document.getElementById('modal-report-body');
    if (!modalBody) return alert('Tiada laporan untuk dicetak.');
    await new Promise(r => setTimeout(r, 400));
    window.print();
  };

  window.downloadReportPDF = async () => {
    const element = document.getElementById('pdf-content-container');
    if (!element) {
      alert('Tiada laporan untuk dimuat turun.');
      return;
    }

    const opt = {
      margin: [10, 10, 10, 10],
      filename: 'Laporan_eHalalGAP.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2, useCORS: true },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };

    try {
      await html2pdf().set(opt).from(element).save();
    } catch (err) {
      console.error('Gagal menjana PDF:', err);
      alert('Gagal menjana PDF. Sila cuba lagi.');
    }
  };
  </script>
</body>
</html>
